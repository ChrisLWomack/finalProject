<!doctype html>
<html>
<head>
  <title>See and Sync</title>
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
  <%# <link rel="stylesheet" href="style.css"> %>
</head>
<body>

  <div class="container">

    <section class="vid" >
    <div id="youtubePlayer">

    </div>
    </section>
    <section class="tracks" >


    <% for(let i=0; i < post.scUrl.length; i++){ %>
      <iframe id="sc-widget<%= i %>" width="100%" height="166" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=<%= post.scUrl[i] %>&show_artwork=true"></iframe>
      <% } %>

      </section>
      <script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
      <script type="text/javascript">
      console.log('hello')
      (function(){
        <% for(let i=0; i < post.scUrl.length; i++){ %>
          var widgetIframe<%= i %> = document.getElementById('sc-widget<%= i %>'),
          widget<%= i %> = SC.Widget(widgetIframe<%= i %>)
          //newSoundUrl = 'http://api.soundcloud.com/tracks/13692671';
          console.log(widget<%= i %>)
          widget<%= i %>.bind(SC.Widget.Events.READY, function() {
            console.log("binding events");
            widget<%= i %>.bind(SC.Widget.Events.PLAY, function() {
              console.log("play button pressed");
            })
            widget<%= i %>.bind(SC.Widget.Events.PAUSE, function() {
              console.log("pause pressed");
            })

            // load new widget
            widget<%= i %>.bind(SC.Widget.Events.FINISH, function() {
              console.log("finished");
              widget<%= i %>.load(newSoundUrl, {
                show_artwork: false
              });
            });
          });

          <% } %>
        }());
        </script>

      </div>

      <!-- <script src="https://www.youtube.com/iframe_api" type="text/javascript"></script> -->

      <%# <script src="main.js" type="text/javascript"></script> %>
      <script type="text/javascript">
      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


      var player;

      function onYouTubeIframeAPIReady() {

        player = new YT.Player('youtubePlayer', {
          height: '390',
          width: '640',
          // videoId: 'M7lc1UVf-VE',
          videoId: '<%= post.videoId %>',
          events: {}
        });

      }

    </script>
  </body>
  </html>
